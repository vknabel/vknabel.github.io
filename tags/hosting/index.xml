<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Hosting on vknabel</title><link>https://vknabel.com/tags/hosting/</link><description>Recent content in Hosting on vknabel</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>© Valentin Knabel</copyright><lastBuildDate>Mon, 12 Dec 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://vknabel.com/tags/hosting/index.xml" rel="self" type="application/rss+xml"/><item><title>My Personal View on Acorn</title><link>https://vknabel.com/posts/my-personal-view-on-acorn/</link><pubDate>Mon, 12 Dec 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/my-personal-view-on-acorn/</guid><description>&lt;p&gt;&lt;a href="https://acorn.io"&gt;Acorn&lt;/a&gt; is an application deployment framework for k8s, that tries to simplify instead of introducing another layer of indirection. I won&amp;rsquo;t cover all details and problems it tries to solve here, instead I&amp;rsquo;d like to share some experiences and thoughts.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Acorn has been discontinued&lt;/strong&gt; and they are now doing some AI slop stuff.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="my-experience-with-acorn-and-kubernetes"&gt;My experience with Acorn and Kubernetes&lt;/h2&gt;
&lt;p&gt;Before we dive right in, I&amp;rsquo;d like to let you know about my level of experience with Kubernetes and Acorn.&lt;/p&gt;
&lt;p&gt;I started having a look on Acorn in August 2022 and played around with it. I did not have production experience with Kubernetes, but I started learning and playing around with it a few months before.&lt;/p&gt;
&lt;p&gt;To get a deeper understanding on k8s, I soon started to migrate my personal services hosted on multiple docker-compose-files. Later I had a look on Acorn and started to play around with it. I also translated my docker-compose-files and k8s manifests to Acorn and liked the result.&lt;/p&gt;
&lt;p&gt;Later I migrated my personal production services to k8s and Acorn. As &lt;a href="http://github.com/vknabel/puffery"&gt;Puffery&lt;/a&gt; only has a few users, there wasn&amp;rsquo;t much risk involved.&lt;/p&gt;
&lt;p&gt;On October 2022, I held a talk about &lt;a href="https://acorn.io"&gt;Acorn&lt;/a&gt; at the &lt;a href="https://community.cncf.io/events/details/cncf-kcd-munich-presents-kubernetes-community-days-munich-2022-1/"&gt;Kubernetes Community Days Munich 2022&lt;/a&gt;. And recently I wrote the &lt;a href="https://www.x-cellent.com/posts/getting-started-with-acorn-for-kubernetes"&gt;corresponding blog post&lt;/a&gt; for my employer&amp;rsquo;s blog to share the contents of the talk.&lt;/p&gt;
&lt;h2 id="secrets"&gt;Secrets&lt;/h2&gt;
&lt;p&gt;Acorn forces you to declare secrets in the &lt;code&gt;Acornfile&lt;/code&gt;, but it forbids you to provide them there. Instead it will automatically generate the secrets on the initial deployment. You don&amp;rsquo;t have to worry about secrets anymore.&lt;/p&gt;
&lt;p&gt;The weird part is, when you have an existing secret. You don&amp;rsquo;t override or change the generated secret. Instead you create a new secret at the command line and link both secrets together.&lt;/p&gt;
&lt;p&gt;But if you are used to it, it&amp;rsquo;s actually a nice way to solve this issue.&lt;/p&gt;
&lt;h2 id="referencing-resources"&gt;Referencing Resources&lt;/h2&gt;
&lt;p&gt;In Acorn you need to reference some resources like a specific secret or volume. Here you use an URL with the appropriate scheme. For example, to reference a secret, you use the &lt;code&gt;secret://&lt;/code&gt; scheme.&lt;/p&gt;
&lt;p&gt;In regards to volumes, this is awesome, as you can even mount a specific path of the volume into a directory. But when using secrets, this is sometimes a bit annoying, as you need to reference the whole secret and then extract the value you need, like &lt;code&gt;secret://db-password/token&lt;/code&gt;. The benefit: you can create a secret to mount multiple files into a container using an opaque secret.&lt;/p&gt;
&lt;p&gt;I understand the reasoning behind using resource URLs, as these resources technically need to be created and are not part of the Acorn Image. But in the beginning this was a bit confusing. Maybe this is just a documentation issue.&lt;/p&gt;
&lt;h2 id="development"&gt;Development&lt;/h2&gt;
&lt;p&gt;For development we always need a vast range of tools. Especially when working with multiple programming languages. I tend to avoid installing those on my local machine and instead use containers. In easier cases I use &lt;a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers"&gt;Remote Containers&lt;/a&gt; for VS Code. For more complex use cases that include databases, I rely on docker-compose. But if the application needs to run in a Kubernetes cluster, it would be twice the work to maintain the &lt;code&gt;docker-compose.yaml&lt;/code&gt; and the k8s manifests. With Acorn, I can use the same manifests for development and production. Of course I need to sprinkle some &lt;code&gt;if&lt;/code&gt; statements in the &lt;code&gt;Acornfile&lt;/code&gt; to make it work for both environments, but it feels much more natural than maintaining two different sets of manifests.&lt;/p&gt;
&lt;p&gt;And to be honest, I think an &lt;code&gt;Acornfile&lt;/code&gt; is far easier to read, than a &lt;code&gt;docker-compose.yaml&lt;/code&gt; or many k8s manifests.&lt;/p&gt;
&lt;h2 id="production-use"&gt;Production Use&lt;/h2&gt;
&lt;p&gt;I have been using Acorn in production for a few months now and I have not encountered any problems so far.
Instead I really like gathering all logs of one application with a single command out of the box: &lt;code&gt;acorn logs [app]&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I also like the fact, that Acorn knows the concept of an app. That way it can provide a great overview about whole applications across multiple resource types.&lt;/p&gt;
&lt;h2 id="conclusion"&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I really like Acorn and I think it&amp;rsquo;s a great tool to simplify the deployment of applications to Kubernetes. It&amp;rsquo;s not perfect, but it&amp;rsquo;s a great start. At the moment I&amp;rsquo;m not sure if I would use it for a production application with a lot of users, but I would definitely use it for my personal projects.&lt;/p&gt;</description></item><item><title>Open Policy Agent</title><link>https://vknabel.com/posts/2022-08-15-open-policy-agent/</link><pubDate>Mon, 15 Aug 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/2022-08-15-open-policy-agent/</guid><description>&lt;p&gt;With OPA you implement decisions of policies, not their enforcement. This avoids confusion between multiple servers that might come from different implementations of the policies.&lt;/p&gt;
&lt;p&gt;The decisions themselves are implemented using the Regi programming language.&lt;/p&gt;
&lt;p&gt;Similar to Prolog, Rego is a declarative and logic programming language. A seldom choice, but a great fit for policies!&lt;/p&gt;</description></item><item><title>Kubernetes without Load Balancers?</title><link>https://vknabel.com/posts/2022-08-06-kubernetes-without-load-balancers/</link><pubDate>Sat, 06 Aug 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/2022-08-06-kubernetes-without-load-balancers/</guid><description>&lt;p&gt;All the hosted Kubernetes solutions I know of want you to pay roughly 10$ pre month for each load balancer.&lt;/p&gt;
&lt;p&gt;If you currently don&amp;rsquo;t expect much traffic, but want to play around with k8s or if many docker-compose files don&amp;rsquo;t fit your needs anymore, this easily doubles your costs.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://downey.io/blog/skip-kubernetes-loadbalancer-with-hostport-daemonset/"&gt;Downey.io – save money and skip the kubernetes load balancer&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Bonus learning: I didn&amp;rsquo;t heard of the &lt;code&gt;DaemonSet&lt;/code&gt; until now!&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Kind is the new minikube</title><link>https://vknabel.com/posts/2022-08-05-kind-is-the-new-minikube/</link><pubDate>Fri, 05 Aug 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/2022-08-05-kind-is-the-new-minikube/</guid><description>&lt;p&gt;I have been playing around with minikube for quite some time now. Though as I run minikube on my Mac, I experienced multiple bugs regarding accessing the cluster and it&amp;rsquo;s published ports.&lt;/p&gt;
&lt;p&gt;From my perspective Kind works much better, is faster, more stable on macOS and allows the creation of multiple clusters. Though it is not bug-free on macOS. Although most bugs seem to be related to Docker itself on the Mac.&lt;/p&gt;
&lt;p&gt;You can even pause the cluster - just pause it&amp;rsquo;s docker container.&lt;/p&gt;</description></item><item><title>Bash scripts with Gum</title><link>https://vknabel.com/posts/2022-08-03-bash-scripts-with-gum/</link><pubDate>Wed, 03 Aug 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/2022-08-03-bash-scripts-with-gum/</guid><description>&lt;p&gt;I gave the newest tool of Charm &lt;a href="https://github.com/charmbracelet/gum"&gt;Gum&lt;/a&gt; a try.
It allows to create interactive bash scripts in just a few lines of code.&lt;/p&gt;
&lt;p&gt;In my case I gave it a try for Kubernetes. I often want to look at the logs of a pod, but the exact k8s pod differs from time to time.
And sometimes I forget the exact namespace or the pod&amp;rsquo;s name includes random characters.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#! /bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# let the user select a namespace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;NAMESPACE&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;kubectl get namespaces -o name | gum choose | cut -d/ -f2&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# let the user select a pod of the namespace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;POD&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;$(&lt;/span&gt;kubectl get pods -n &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$NAMESPACE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; | tail -n +2 | gum choose | cut -d&lt;span style="color:#e6db74"&gt;&amp;#39; &amp;#39;&lt;/span&gt; -f1&lt;span style="color:#66d9ef"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# if you want to repeat, copy the command&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;echo &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;gt; kubectl logs -n \&amp;#34;&lt;/span&gt;$NAMESPACE&lt;span style="color:#e6db74"&gt;\&amp;#34; \&amp;#34;&lt;/span&gt;$POD&lt;span style="color:#e6db74"&gt;\&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;# print the logs&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;kubectl logs -n &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$NAMESPACE&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;$POD&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description></item><item><title>Kubernetes Overview for Beginners</title><link>https://vknabel.com/posts/2022-05-25-kubernetes-overview/</link><pubDate>Wed, 25 May 2022 00:00:00 +0000</pubDate><guid>https://vknabel.com/posts/2022-05-25-kubernetes-overview/</guid><description>&lt;p&gt;I have never done anything productive with Kubernetes before. But it is a really tough topic to get started with. It&amp;rsquo;s overwhelming.&lt;/p&gt;
&lt;p&gt;Luckily I found an excellent &lt;a href="https://www.youtube.com/watch?v=X48VuDVv0do"&gt;Kubernetes tutorial on Youtube&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I made some personal notes while watching. Mostly to keep some overview for all the different concepts.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Today I haven&amp;rsquo;t finished the video, so the overview is only a rough draft. Some missing concepts are Storage Classes, Ingress Controllers and more!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="kubernetes-concepts"&gt;Kubernetes Concepts&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;a &lt;strong&gt;Pod&lt;/strong&gt; is an abstraction of usually one container.&lt;/li&gt;
&lt;li&gt;all &lt;strong&gt;IP addresses&lt;/strong&gt; are assigned and changed with every restart&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pods&lt;/strong&gt; communicate using &lt;strong&gt;Services&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;External Services&lt;/strong&gt; are accessible by IP and port&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ingress&lt;/strong&gt; is used for external access using domains&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;ConfigMap&lt;/strong&gt; holds configuration data. Changing the config map prevents whole rebuilds and redeploys of specifc pods&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Secrets&lt;/strong&gt; are like &lt;strong&gt;ConfigMaps&lt;/strong&gt;, but for sensitive data. Values are by default base64 encoded in the YAML.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Volumes&lt;/strong&gt; connect storage (local or remote) to a &lt;strong&gt;Pod&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Kubernetes does not handle storage!&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LoadBalancers&lt;/strong&gt; are a type of &lt;strong&gt;Services&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Replicas&lt;/strong&gt; are the amount of &lt;strong&gt;Deployments&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Deployments&lt;/strong&gt; are blueprints for &lt;strong&gt;Pods&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;StatefulSets&lt;/strong&gt; are like &lt;strong&gt;Deployments&lt;/strong&gt;, but stateful.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;They are designed to databases etc to avoid data inconsistency.&lt;/li&gt;
&lt;li&gt;Harder to get right than a simple &lt;strong&gt;Deployment&lt;/strong&gt;.&lt;/li&gt;
&lt;li&gt;Databases are often deployed outside the cluster.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;StatefulSet&lt;/strong&gt; has volume claim templates, to create independent storage for each replica.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;volumeClaimTemplates&lt;/code&gt; create a volume claim for each replica.&lt;/p&gt;
&lt;h2 id="kubernetes-architecture"&gt;Kubernetes Architecture&lt;/h2&gt;
&lt;p&gt;Master nodes and worker nodes are kept separate to keep the cluster controllable. Imagine you couldn&amp;rsquo;t manage your cluster to increase the number of worker nodes or replicas.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Worker Nodes&lt;/strong&gt;
Runs multiple pods.&lt;/p&gt;
&lt;p&gt;3 processes are running on each node:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;container runtime&lt;/li&gt;
&lt;li&gt;the Kubelet connects container runtime and the configuration&lt;/li&gt;
&lt;li&gt;the kube proxy routes requests to services)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Master Nodes&lt;/strong&gt;
Manage the worker nodes.&lt;/p&gt;
&lt;p&gt;Runs 4 processes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Api Server / cluster gateway / authentication&lt;/li&gt;
&lt;li&gt;the Scheduler that decides which worker node gets workload&lt;/li&gt;
&lt;li&gt;Controller Manager observes the state of the cluster and makes changes&lt;/li&gt;
&lt;li&gt;etcd is a Key-Value-Store for k8n&lt;/li&gt;
&lt;/ul&gt;</description></item></channel></rss>