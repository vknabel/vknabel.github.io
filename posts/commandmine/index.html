<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>CommandMine | vknabel</title><link rel=stylesheet href=/css/main.min.e9fd179d6f16b595a4ec4953ef9042fa8e3bcdf9755535ae526ed686593a3ced.css integrity="sha256-6f0XnW8WtZWk7ElT75BC+o47zfl1VTWuUm7Whlk6PO0=" crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel=stylesheet><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><link rel=icon type=image/png href=/images/vknabel.jpg><link rel=me href=https://mastodon.social/@vknabel><meta name=fediverse:creator content="@vknabel@mastodon.social"><script defer src=https://uma.knabel.dev/umami data-website-id=6c602988-83e0-47c7-a844-d7c4e6edc43d data-domains=www.vknabel.com></script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Command mine is a concept of a swift library for parsing command line arguments. It is designed to support asynchronous implementations of CLIS, that may even be used inside frameworks."><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/commandmine/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="CommandMine"><meta property="og:description" content="Command mine is a concept of a swift library for parsing command line arguments. It is designed to support asynchronous implementations of CLIS, that may even be used inside frameworks."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-08T00:00:00+00:00"><meta property="article:modified_time" content="2017-03-08T00:00:00+00:00"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Tooling"><meta name=twitter:card content="summary"><meta name=twitter:title content="CommandMine"><meta name=twitter:description content="Command mine is a concept of a swift library for parsing command line arguments. It is designed to support asynchronous implementations of CLIS, that may even be used inside frameworks."><link rel=alternate type=application/rss+xml href=https://vknabel.com/index.xml title=News><link rel=alternate type=application/rss+xml href=https://vknabel.com/posts/index.xml title=Posts><link rel=alternate type=application/rss+xml href=https://vknabel.com/library/index.xml title=Library><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/announcement/index.xml title="Tagged with Announcement"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/books/index.xml title="Tagged with Books"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/go/index.xml title="Tagged with Go"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/hosting/index.xml title="Tagged with Hosting"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/lithia/index.xml title="Tagged with Lithia"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/plants/index.xml title="Tagged with Plants"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/puffery/index.xml title="Tagged with Puffery"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/swift/index.xml title="Tagged with Swift"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/tooling/index.xml title="Tagged with Tooling"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/web/index.xml title="Tagged with Web"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/zirric/index.xml title="Tagged with Zirric"></head><body><div class=content><header><nav class=menu-main><ul><li><a aria-current=true class=ancestor href=/posts/>Blog</a></li><li><a href=/library/>Library</a></li></ul></nav><a href=/ class=logo>vk</a><nav class=menu-secondary><ul><li><a href=/about/>About</a></li></ul></nav></header><main><h1>CommandMine</h1><small><i>Posted on <time datetime=2017-03-08T00:00:00+00:00>2017-03-08</time></i></small><p>Command mine is a concept of a swift library for parsing command line arguments. It is designed to support asynchronous implementations of CLIS, that may even be used inside frameworks.</p><h2 id=definitions>Definitions</h2><p>CommandMine is about extracting minerals out of your ore.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> goldmine = Mine&lt;Gold&gt;() <span style=color:#75715e>// declare your mine</span>
</span></span><span style=display:flex><span> .drift( <span style=color:#75715e>// One way to get to your gold</span>
</span></span><span style=display:flex><span>  named: <span style=color:#e6db74>&#34;init&#34;</span>,
</span></span><span style=display:flex><span>  digging drift: Drift, <span style=color:#75715e>// Prepares your Shaft</span>
</span></span><span style=display:flex><span>  to shaft: execute <span style=color:#75715e>// your actual program</span>
</span></span><span style=display:flex><span> )
</span></span></code></pre></div><h3 id=shaft>Shaft</h3><p>A protocol describing factories of <em>Rails</em>.</p><h3 id=mine>Mine</h3><p>Your program. Is a Shaft.</p><h3 id=drift>Drift</h3><p>A special form of a Shaft, that parses raw ore (<code>[String]</code>) into minerals.</p><h3 id=ore>Ore</h3><p>The arguments passed to your program.</p><h3 id=lore>Lore</h3><p>An event wrapper around minerals.</p><h3 id=mineral>Mineral</h3><p>The desired mineral of your mine.</p><h3 id=rail>Rail</h3><p>Transports your filled Lores.
A simple typealias for <em>Observables</em> of <em>Lores</em>.</p><h3 id=elevator>Elevator</h3><p>The fastest connection to the outside. A Rx wrapper around print and read line.</p><p>The idea behind the elevator is to make your CLI embeddable as library without any changes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>let</span> ele = Elevator&lt;String, String&gt;()
</span></span><span style=display:flex><span>ele.onNext(.error(<span style=color:#e6db74>&#34;&#34;</span>)) <span style=color:#75715e>//.success(&#34;&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Elevator.
</span></span></code></pre></div><h2 id=reusability>Reusability</h2><p>CommandMine tries to keep your CLIs independent from STDIO and may be used asynchronously.</p><p>Additionally it is important to keep parts of your code reusable and replaceable: your CLI may evolve.</p><h3 id=framework-support>Framework Support</h3><p>When it comes to internal or higher level tooling, frameworks suite better than plain CLIs as it eliminates the need to deal with another binary in your path, that your users need to install and keep up to date. Instead it will be compiled within your own target.</p><p>In order to split your project into a framework and CLI, you just declare your mine and drifts in <code>YourMine</code>, everything else in <code>YourShaft</code> and in your executable&rsquo;s <code>main.swift</code> you just start your mine.</p><blockquote><p><em>Hint:</em> you can create this project layout with <code>mine init</code>.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>YourMine</span>
</span></span><span style=display:flex><span>yourMine.runMain()
</span></span></code></pre></div><p>So <code>YourShaft</code> will be good for everyone who either wants to provide a complete new CLI using your logic, or for non CLIs.
At first exporting your mine and drifts into <code>YourMine</code> seems awkward, but it may actually help others to embed your project as a subcommand (after all Mines are just complex Shafts) or to just reuse one drift.</p><h2 id=summary>Summary</h2><ul><li><code>Mine</code>: your CLIs, tasks arguments</li><li><code>Drift</code>: parses arguments for Shaft, sync</li><li><code>Cage</code>: the options</li><li><code>Shaft</code>: a command, async</li><li><code>Elevator</code>: user feedback</li></ul><p>A <code>Drift</code> is an <code>Observable</code> Factory that emits one single <code>Lore</code> or an error with its help.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>CommandMine</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> main = Shaft(named: <span style=color:#e6db74>&#34;rock&#34;</span>, summary: <span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span> .drift(named: <span style=color:#e6db74>&#34;init&#34;</span>, explainedBy: <span style=color:#e6db74>&#34;Creates a new project&#34;</span>) { (cage: EmptyLore) <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> initObsi
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main.run { result <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>switch</span> result {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>case</span> .success(<span style=color:#66d9ef>_</span>), .usage(<span style=color:#66d9ef>_</span>, <span style=color:#66d9ef>_</span>), .error(<span style=color:#66d9ef>_</span>):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Shaft.name
</span></span><span style=display:flex><span>Shaft.instructions
</span></span><span style=display:flex><span>Shaft.drifts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>MineResult</span>&lt;A&gt; {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>case</span> success(A)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>case</span> usage(String?, String?)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>case</span> error(Error) <span style=color:#75715e>// thrown errors will be inserted</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span><span style=color:#f92672>/</span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Drift</span>&lt;Arguments, Result&gt;: Drifty {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> bindTo: (Arguments) -&gt; Observable&lt;MineEvent&lt;Result&gt;<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Drifty.map
</span></span><span style=display:flex><span>Drifty.flatMap
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span><span style=color:#f92672>/</span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Shaft</span>&lt;A&gt;: Drifty {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> usage: (String?, String?)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> rootDrift: Drifts<span style=color:#f92672>&lt;</span>[String], A&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Shaft</span> {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>init</span>(named: String, instructions: String? = <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>drift</span>&lt;Cage&gt;(named: String, instructions: String? = <span style=color:#66d9ef>nil</span>, cage: Cage.<span style=color:#66d9ef>Type</span> = Cage.<span style=color:#66d9ef>self</span>, <span style=color:#66d9ef>_</span>: @escaping Drift&lt;Cage, A&gt;) -&gt; Shaft&lt;A&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Drift</span> {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>positional</span>(parameter: @escaping (String) -&gt; Observable&lt;A&gt;) -&gt; [String] -&gt; Observable&lt;MineResult<span style=color:#f92672>&lt;</span>([String], A)<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> { args <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>guard</span> <span style=color:#66d9ef>let</span> arg = args.first <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> .of(.usage(<span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>nil</span>))
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>return</span> Jfkf
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>exhaustive</span>()
</span></span><span style=display:flex><span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>optional</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=whats-next>What&rsquo;s next?</h2><p>An alternative concept for modeling CLIs in Swift is <a href=/pages/ArgumentOverture>ArgumentOverture</a>, which would have much less impact on the actual program.</p><p>This concept is probably too big and hard to adapt for the benefit it will provide. Though the name is quite nice. ðŸ˜…</p><ul class=tags><li class="tags-item tags-item--tag"><a href=/tags/swift/>Swift</a></li><li class="tags-item tags-item--tag"><a href=/tags/tooling/>Tooling</a></li></div></main><footer><div><small>2026 Â© Valentin Knabel</small><br><small>Made with â™¥ by a human.</small><br></div><div><h6 id=menu-social>Social</h6><nav class=menu-social><ul><li><a href=https://github.com/vknabel>GitHub</a></li><li><a href=https://mastodon.social/@vknabel/>Mastodon</a></li><li><a href=https://code.knabel.dev/explore/repos>code.knabel.dev</a></li><li><a href=/rss/>RSS</a></li></ul></nav></div><div><h6 id=menu-links>Links</h6><nav class=menu-tertiary><ul><li><a href=/now/>Now</a></li><li><a href=/colophon/>Colophon</a></li><li><a href=/projects/>Projects</a></li><li><a href=/sovereignity/>Sovereignity</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></footer></div></body></html>