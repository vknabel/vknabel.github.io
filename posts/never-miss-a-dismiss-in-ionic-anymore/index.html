<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Never miss a dismiss in Ionic anymore - vknabel</title><link rel=icon type=image/png href=/images/vknabel.jpg><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Have you ever experienced, that some loading indicators just don’t want to dismiss and literally stay forever? Maybe while users tried to login? The short story: you probably forgot to dismiss a loading indicator in some cases.
Within this blogpost you will learn how to declaratively present loading indicators and how to prevent forgetting to dismissing it again.
In our showcase we have a login page, that shall present a loading indicator while the user will be authenticated. The page itself only consists of inputs for our credentials and a login button calling LoginPage.submitLogin on click inside ion-content."><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/never-miss-a-dismiss-in-ionic-anymore/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="Never miss a dismiss in Ionic anymore"><meta property="og:description" content="Have you ever experienced, that some loading indicators just don’t want to dismiss and literally stay forever? Maybe while users tried to login? The short story: you probably forgot to dismiss a loading indicator in some cases.
Within this blogpost you will learn how to declaratively present loading indicators and how to prevent forgetting to dismissing it again.
In our showcase we have a login page, that shall present a loading indicator while the user will be authenticated. The page itself only consists of inputs for our credentials and a login button calling LoginPage.submitLogin on click inside ion-content."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-09-26T00:00:00+00:00"><meta property="article:modified_time" content="2017-09-26T00:00:00+00:00"><meta property="article:tag" content="Web"><meta name=twitter:card content="summary"><meta name=twitter:title content="Never miss a dismiss in Ionic anymore"><meta name=twitter:description content="Have you ever experienced, that some loading indicators just don’t want to dismiss and literally stay forever? Maybe while users tried to login? The short story: you probably forgot to dismiss a loading indicator in some cases.
Within this blogpost you will learn how to declaratively present loading indicators and how to prevent forgetting to dismissing it again.
In our showcase we have a login page, that shall present a loading indicator while the user will be authenticated. The page itself only consists of inputs for our credentials and a login button calling LoginPage.submitLogin on click inside ion-content."><script src=https://vknabel.com/js/feather.min.js></script><link href=https://vknabel.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://vknabel.com/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://vknabel.com/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css href=/css/overrides.css></head><body><div class=content><header><div class=main><a href=https://vknabel.com/>vknabel</a></div><nav><a href=/>blog</a>
<a href=/tils>tils</a>
<a href=/about>about</a>
<a href=/tags>tags</a></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Never miss a dismiss in Ionic anymore</h1><div class=meta>Posted on Sep 26, 2017</div></div><section class=body><p>Have you ever experienced, that some loading indicators just don’t want to dismiss and literally stay forever? Maybe while users tried to login? The short story: you probably forgot to dismiss a loading indicator in some cases.</p><p>Within this blogpost you will learn how to declaratively present loading indicators and how to prevent forgetting to dismissing it again.</p><p>In our showcase we have a login page, that shall present a <a href=https://ionicframework.com/docs/components/#loading>loading</a> indicator while the user will be authenticated. The page itself only consists of inputs for our credentials and a login button calling <code>LoginPage.submitLogin</code> on click inside <code>ion-content</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>ion-content</span> <span style=color:#a6e22e>padding</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>ion-input</span> <span style=color:#960050;background-color:#1e0010>[(</span><span style=color:#a6e22e>ngModel</span><span style=color:#960050;background-color:#1e0010>)]=&#34;</span><span style=color:#a6e22e>username</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>&gt;&lt;/<span style=color:#f92672>ion-input</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>ion-input</span> <span style=color:#960050;background-color:#1e0010>[(</span><span style=color:#a6e22e>ngModel</span><span style=color:#960050;background-color:#1e0010>)]=&#34;</span><span style=color:#a6e22e>password</span><span style=color:#960050;background-color:#1e0010>&#34;</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;password&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>&gt;&lt;/<span style=color:#f92672>ion-input</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>ion-button</span> <span style=color:#960050;background-color:#1e0010>(</span><span style=color:#a6e22e>click</span><span style=color:#960050;background-color:#1e0010>)=&#34;</span><span style=color:#a6e22e>submitLogin</span><span style=color:#960050;background-color:#1e0010>()&#34;</span>&gt;&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>ion-content</span>&gt;
</span></span></code></pre></div><p>Our <code>LoginPage</code> relies on an <code>AuthenticationService</code>, mocked as follows.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthenticationService</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#a6e22e>login</span>(<span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>, <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>)<span style=color:#f92672>:</span> <span style=color:#a6e22e>Observable</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>void</span><span style=color:#f92672>&gt;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Once the user clicked on the login button, we will create a <code>Loading</code> using the <code>LoadingController</code>, present it and perform the login itself. Thereafter we need to dismiss the same <code>Loading</code> again.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>IonicPage</span>()
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;./login.page.html&#34;</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginPage</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>username</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>password</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>authentication</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AuthenticationService</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>navCtrl</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>NavController</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>loadingCtrl</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>LoadingController</span>
</span></span><span style=display:flex><span>  ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>submitLogin</span>() {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// configure loading spinner
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>loading</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>loadingCtrl</span>.<span style=color:#a6e22e>create</span>();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// present it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>loading</span>.<span style=color:#a6e22e>present</span>().<span style=color:#a6e22e>then</span>(() =&gt;
</span></span><span style=display:flex><span>      <span style=color:#75715e>// perform login
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>authentication</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>login</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>username</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>toPromise</span>()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// on success dismiss
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>loading</span>.<span style=color:#a6e22e>dismiss</span>())
</span></span><span style=display:flex><span>        <span style=color:#75715e>// and apply successful login
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>navCtrl</span>.<span style=color:#a6e22e>setRoot</span>(<span style=color:#e6db74>&#34;MyEntryPage&#34;</span>))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You might have noticed, but we already introduced a bug: if the login fails, our promise rejects and <code>.then(() => loading.dismiss())</code> will never be called, our <code>Loading</code> will still be presented and the user will be forced to restart the whole app in order to try the correct credentials.
The most obvious fix would be to just insert a <code>catch</code> which dismissed the loading, too. But this would not prevent any other usages of <code>Loading</code> from being presented forever.</p><p>In order to solve this problem, we will create a new controller, which will present loadings and automatically dismisses them once a given promise resolves or rejects.
We want our <code>submitLogin</code> to be completely free from all <code>loading.dismiss()</code> calls and even the requirement to even keep our <code>loading</code> variable. Additionally we don’t want to be forced to either subscribe to an observable nor to convert it to a promise.</p><p>The code we want inside <code>LoginPage.submitLogin</code> should be focused and compact.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#a6e22e>submitLogin</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// present while ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>activityCtrl</span>
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>presentWhile</span>(
</span></span><span style=display:flex><span>      <span style=color:#75715e>// ... logging in
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>authentication</span>.<span style=color:#a6e22e>login</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>username</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#75715e>// on success, apply login
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    .<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>navCtrl</span>.<span style=color:#a6e22e>setRoot</span>(<span style=color:#e6db74>&#34;MyEntryPage&#34;</span>));
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Our <code>presentWhile</code> will be implemented inside a service called <code>ActivityController</code> and will either work with promises or observables. It handles dismissing our loading spinner and returns a new promise resolving to the same value (or rejecting to the same error).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>Injectable</span>()
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ActivityController</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>loadingCtrl</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>LoadingController</span>) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>presentWhile</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>active</span><span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>Observable</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>options</span><span style=color:#f92672>?:</span> <span style=color:#a6e22e>LoadingOptions</span>
</span></span><span style=display:flex><span>  )<span style=color:#f92672>:</span> Promise<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>T</span><span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// create loading using optionally given options
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>spinner</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>loadingCtrl</span>.<span style=color:#a6e22e>create</span>(<span style=color:#a6e22e>options</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>spinner</span>
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>present</span>()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// convert observables to promises
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        .<span style=color:#a6e22e>then</span>(
</span></span><span style=display:flex><span>          () =&gt; (<span style=color:#a6e22e>active</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>Observable</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>active</span>.<span style=color:#a6e22e>toPromise</span>() <span style=color:#f92672>:</span> <span style=color:#a6e22e>active</span>)
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        <span style=color:#75715e>// dismiss and keep result
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        .<span style=color:#a6e22e>then</span>(<span style=color:#a6e22e>result</span> =&gt; <span style=color:#a6e22e>spinner</span>.<span style=color:#a6e22e>dismiss</span>().<span style=color:#a6e22e>then</span>(() =&gt; <span style=color:#a6e22e>result</span>))
</span></span><span style=display:flex><span>        <span style=color:#75715e>// keep the error, but dismiss
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        .<span style=color:#66d9ef>catch</span>(<span style=color:#a6e22e>error</span> =&gt; <span style=color:#a6e22e>spinner</span>.<span style=color:#a6e22e>dismiss</span>().<span style=color:#a6e22e>then</span>(() =&gt; Promise.<span style=color:#a6e22e>reject</span>(<span style=color:#a6e22e>error</span>)))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In order to actually use <code>ActivityController</code> in our <code>LoginPage</code>, we need to inject it. As there Ionic’s controllers (<code>LoadingController</code>, <code>NavController</code>, etc.) will be injected for each page separately, we need to do the same for each page, too.
Inside your unit tests, you can <a href=https://angular.io/guide/testing#component-override>override providers</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>IonicPage</span>()
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>Component</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>templateUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;./login.page.html&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#75715e>// add provider to component
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>provders</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>ActivityController</span>]
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LoginPage</span> {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// username, password
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>authentication</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>AuthenticationService</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>navCtrl</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>NavController</span>,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>readonly</span> <span style=color:#a6e22e>activityCtrl</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ActivityController</span>
</span></span><span style=display:flex><span>  ) {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// submitLogin()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Within this blogpost you have seen which problems may occur when using loading spinners and how to solve them in general. Furthermore you learnt how to create a new controller for Ionic and how to use it.</p><p>Do you have more ideas for using a pattern like this?</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/web>web</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/vknabel rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://mastodon.social/@vknabel/ rel=me title=Mastodon><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#at-sign"/></svg></a><a class=border></a></div><div class=footer-info>2025 © Valentin Knabel | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>