<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Swifducks: simple Redux store with multiple reducers | vknabel</title><link rel=stylesheet href=/css/main.min.e9fd179d6f16b595a4ec4953ef9042fa8e3bcdf9755535ae526ed686593a3ced.css integrity="sha256-6f0XnW8WtZWk7ElT75BC+o47zfl1VTWuUm7Whlk6PO0=" crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel=stylesheet><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><link rel=icon type=image/png href=/images/vknabel.jpg><link rel=me href=https://mastodon.social/@vknabel><meta name=fediverse:creator content="@vknabel@mastodon.social"><script defer src=https://uma.knabel.dev/umami data-website-id=6c602988-83e0-47c7-a844-d7c4e6edc43d data-domains=www.vknabel.com></script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A simple example implementation of the Redux pattern with multiple reducers and listeners."><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/swifducks-simple-redux-store-with-multiple-reducers/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="Swifducks: simple Redux store with multiple reducers"><meta property="og:description" content="A simple example implementation of the Redux pattern with multiple reducers and listeners."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-15T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-15T00:00:00+00:00"><meta property="article:tag" content="Swift"><meta name=twitter:card content="summary"><meta name=twitter:title content="Swifducks: simple Redux store with multiple reducers"><meta name=twitter:description content="A simple example implementation of the Redux pattern with multiple reducers and listeners."><link rel=alternate type=application/rss+xml href=https://vknabel.com/index.xml title=News><link rel=alternate type=application/rss+xml href=https://vknabel.com/posts/index.xml title=Posts><link rel=alternate type=application/rss+xml href=https://vknabel.com/library/index.xml title=Library><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/announcement/index.xml title="Tagged with Announcement"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/books/index.xml title="Tagged with Books"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/go/index.xml title="Tagged with Go"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/hosting/index.xml title="Tagged with Hosting"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/lithia/index.xml title="Tagged with Lithia"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/plants/index.xml title="Tagged with Plants"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/puffery/index.xml title="Tagged with Puffery"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/swift/index.xml title="Tagged with Swift"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/tooling/index.xml title="Tagged with Tooling"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/web/index.xml title="Tagged with Web"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/zirric/index.xml title="Tagged with Zirric"></head><body><div class=content><header><nav class=menu-main><ul><li><a aria-current=true class=ancestor href=/posts/>Blog</a></li><li><a href=/library/>Library</a></li></ul></nav><a href=/ class=logo>vk</a><nav class=menu-secondary><ul><li><a href=/about/>About</a></li></ul></nav></header><main><h1>Swifducks: simple Redux store with multiple reducers</h1><small><i>Posted on <time datetime=2019-10-15T00:00:00+00:00>2019-10-15</time></i></small><p>A simple example implementation of the Redux pattern with multiple reducers and listeners.</p><p>The name is derived from Swift + Redux = üèéü¶Ü</p><p><em>Originally written at 2018-06-10</em></p><h2 id=definitions>Definitions</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Store</span>&lt;State, Action&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>typealias</span> Reducer = (Action, <span style=color:#66d9ef>inout</span> State) -&gt; Void
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>private</span>(<span style=color:#66d9ef>set</span>) <span style=color:#66d9ef>var</span> state: State
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> reducers: [Reducer] = []
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>var</span> callbacks: [Weak&lt;Listener&lt;State&gt;<span style=color:#f92672>&gt;</span>] = []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>init</span>(initial state: State) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.state = state
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>select</span>(<span style=color:#66d9ef>_</span> changes: @escaping (State) -&gt; Void) -&gt; Any {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> subscription = Listener(on: changes)
</span></span><span style=display:flex><span>        callbacks.append(Weak(subscription))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> subscription
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>reduce</span>(with reducer: @escaping Reducer) {
</span></span><span style=display:flex><span>        reducers.append(reducer)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>dispatch</span>(<span style=color:#66d9ef>_</span> action: Action) {
</span></span><span style=display:flex><span>        state = reducers.reduce(into: state) { intermediate, reducer <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            reducer(action, &amp;intermediate)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        callbacks = callbacks
</span></span><span style=display:flex><span>            .compactMap { $0.value }
</span></span><span style=display:flex><span>            .map(Weak.<span style=color:#66d9ef>init</span>)
</span></span><span style=display:flex><span>        callbacks.forEach { $0.value?.onChange(state) }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>extension</span> <span style=color:#a6e22e>Store</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>convenience</span> <span style=color:#66d9ef>init</span>(initial state: State, reducer: @escaping Reducer) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.<span style=color:#66d9ef>init</span>(initial: state)
</span></span><span style=display:flex><span>        reduce(with: reducer)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Weak</span>&lt;A: AnyObject&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>weak</span> <span style=color:#66d9ef>var</span> value: A?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(<span style=color:#66d9ef>_</span> value: A?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.value = value
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Listener</span>&lt;State&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> onChange: (State) -&gt; Void
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>init</span>(on change: @escaping (State) -&gt; Void) {
</span></span><span style=display:flex><span>        onChange = change
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=example-usage>Example Usage</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#66d9ef>enum</span> <span style=color:#a6e22e>IntAction</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> increase
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> decrease
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> root = Store&lt;Int, IntAction&gt;(initial: <span style=color:#ae81ff>0</span>) { action, state <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> action {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> .increase:
</span></span><span style=display:flex><span>        state <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> .decrease:
</span></span><span style=display:flex><span>        state <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> sideEffect = <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> listener: Any? = root.select {
</span></span><span style=display:flex><span>    sideEffect = $0
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root.dispatch(.increase)
</span></span><span style=display:flex><span>root.state <span style=color:#75715e>// will be 1</span>
</span></span><span style=display:flex><span>sideEffect <span style=color:#75715e>// will be 1</span>
</span></span><span style=display:flex><span>listener = <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>root.dispatch(.decrease)
</span></span><span style=display:flex><span>root.state <span style=color:#75715e>// will be 0</span>
</span></span><span style=display:flex><span>sideEffect <span style=color:#75715e>// will be 1</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Without explicit support for modularity, supporting multiple reducers as above is probably not needed. Instead some composability functions should be used.</p><p>On the other hand: it is obvious, that are implementing the Redux pattern and embracing unidirectional data flow is relatively easy.</p><p><em><a href=./playground.zip>download this playground</a></em></p><ul class=tags><li class="tags-item tags-item--tag"><a href=/tags/swift/>Swift</a></li></div></main><footer><div><small>2026 ¬© Valentin Knabel</small><br><small>Made with ‚ô• by a human.</small><br></div><div><h6 id=menu-social>Social</h6><nav class=menu-social><ul><li><a href=https://github.com/vknabel>GitHub</a></li><li><a href=https://mastodon.social/@vknabel/>Mastodon</a></li><li><a href=https://code.knabel.dev/explore/repos>code.knabel.dev</a></li><li><a href=/rss/>RSS</a></li></ul></nav></div><div><h6 id=menu-links>Links</h6><nav class=menu-tertiary><ul><li><a href=/now/>Now</a></li><li><a href=/colophon/>Colophon</a></li><li><a href=/projects/>Projects</a></li><li><a href=/sovereignity/>Sovereignity</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></footer></div></body></html>