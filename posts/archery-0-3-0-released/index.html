<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Archery 0.3.0 released | vknabel</title><link rel=stylesheet href=/css/main.min.e9fd179d6f16b595a4ec4953ef9042fa8e3bcdf9755535ae526ed686593a3ced.css integrity="sha256-6f0XnW8WtZWk7ElT75BC+o47zfl1VTWuUm7Whlk6PO0=" crossorigin=anonymous><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inria+Serif:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel=stylesheet><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script><link rel=icon type=image/png href=/images/vknabel.jpg><link rel=me href=https://mastodon.social/@vknabel><meta name=fediverse:creator content="@vknabel@mastodon.social"><script defer src=https://uma.knabel.dev/umami data-website-id=6c602988-83e0-47c7-a844-d7c4e6edc43d data-domains=www.vknabel.com></script><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Archery is about doing something with your project‚Äôs metadata. The new version 0.3.0 puts everything on steroids and allows you to script your metadata.
A detailed overview of all changes can be found on GitHub."><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/archery-0-3-0-released/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="Archery 0.3.0 released"><meta property="og:description" content="Archery is about doing something with your project‚Äôs metadata. The new version 0.3.0 puts everything on steroids and allows you to script your metadata. A detailed overview of all changes can be found on GitHub."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-12T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-12T00:00:00+00:00"><meta property="article:tag" content="Tooling"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Announcement"><meta name=twitter:card content="summary"><meta name=twitter:title content="Archery 0.3.0 released"><meta name=twitter:description content="Archery is about doing something with your project‚Äôs metadata. The new version 0.3.0 puts everything on steroids and allows you to script your metadata. A detailed overview of all changes can be found on GitHub."><link rel=alternate type=application/rss+xml href=https://vknabel.com/index.xml title=News><link rel=alternate type=application/rss+xml href=https://vknabel.com/posts/index.xml title=Posts><link rel=alternate type=application/rss+xml href=https://vknabel.com/library/index.xml title=Library><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/announcement/index.xml title="Tagged with Announcement"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/books/index.xml title="Tagged with Books"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/go/index.xml title="Tagged with Go"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/hosting/index.xml title="Tagged with Hosting"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/lithia/index.xml title="Tagged with Lithia"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/plants/index.xml title="Tagged with Plants"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/puffery/index.xml title="Tagged with Puffery"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/swift/index.xml title="Tagged with Swift"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/tooling/index.xml title="Tagged with Tooling"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/web/index.xml title="Tagged with Web"><link rel=alternate type=application/rss+xml href=https://vknabel.com/tags/zirric/index.xml title="Tagged with Zirric"></head><body><div class=content><header><nav class=menu-main><ul><li><a aria-current=true class=ancestor href=/posts/>Blog</a></li><li><a href=/library/>Library</a></li></ul></nav><a href=/ class=logo>vk</a><nav class=menu-secondary><ul><li><a href=/about/>About</a></li></ul></nav></header><main><h1>Archery 0.3.0 released</h1><small><i>Posted on <time datetime=2019-10-12T00:00:00+00:00>2019-10-12</time></i></small><p><em>Archery</em> is about doing something with your project‚Äôs metadata. The new version 0.3.0 puts everything on steroids and allows you to script your metadata.
A detailed overview of all changes can be found on <a href=https://github.com/vknabel/Archery/blob/master/CHANGELOG.md#021>GitHub</a>.</p><h2 id=archerfile-loaders>Archerfile Loaders</h2><p>At first you will notice the new option to load additional contents into your Archerfile an incredibly open field of new possibilities.
The most obvious use case is to collect metadata from multiple configuration files.
At a second look you can even script the generation of your metadata.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>loaders</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>cat Metadata/*.yml</span>
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#34;echo today: $(date +%Y-%m-%d)&#34;</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>mirror file https://raw.githubusercontent.com/vknabel/Archery/0.3.0/Examples/MapSwiftTargetsToScripts.yml</span>
</span></span></code></pre></div><p>But caution: your loader will be executed with every invocation of Archery. Make sure they run fast enough!</p><h2 id=sequence-of-scripts>Sequence of Scripts</h2><p>Often one script requires multiple steps. In earlier versions we used <code>vknabel/ArcheryArrow</code> for this purpose. Now we can be much more direct:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>run</span>: [<span style=color:#ae81ff>host, swift5.0, swift5.1]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>host</span>: <span style=color:#ae81ff>swift test</span>
</span></span><span style=display:flex><span><span style=color:#f92672>swift5.0</span>: <span style=color:#ae81ff>docker ...</span>
</span></span><span style=display:flex><span><span style=color:#f92672>swift5.1</span>: <span style=color:#ae81ff>docker ...</span>
</span></span></code></pre></div><h2 id=environment-variables>Environment variables</h2><p>Let‚Äôs assume we have <code>Metadata/Scripts.yml</code> with the following contents:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>dump</span>: <span style=color:#ae81ff>echo $ARCHERY_METADATA</span>
</span></span></code></pre></div><p>In here we use our second new feature: using env variables to access our Archerfile contents!</p><p>On execution you will receive the fully loaded metadata as JSON!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>$ archery dump
</span></span><span style=display:flex><span>üèπ  Running scripts ‚ñ∂Ô∏é dump
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;loaders&#34;</span>:<span style=color:#f92672>[]</span>,<span style=color:#e6db74>&#34;scripts&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;dump&#34;</span>:<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;command&#34;</span>:<span style=color:#e6db74>&#34;echo </span>$ARCHERY_METADATA<span style=color:#e6db74>&#34;</span><span style=color:#f92672>}}</span>,<span style=color:#e6db74>&#34;today&#34;</span>:<span style=color:#e6db74>&#34;2019-10-10&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>A full list of all exposed environment variables visit <a href=https://github.com/vknabel/Archery>Archery on GitHub</a>.</p><p>To accomplish this the whole underlying script execution mechanism has been rebuild from scratch.
Previously scripts relied on separate SwiftPM repositories, called Arrows, which would be installed by Archery using Mint. For many use cases this mechanism required too much ceremony around it. For example the <code>vknabel/BashArrow</code> would have to be compiled before running your actual script.
Instead we focus on the easiest and fastest scripting mechanism: bash scripts.
Though this will not break: Archery will generate the correct Mint commands and will execute your arrows as before if you have Mint installed.</p><p>Aside from the speed up for bash scripts, the <code>vknabel/ArcheryArrow</code> will come pre-shipped too and doesn‚Äòt take a whole Swift build to proceed.</p><h2 id=faq-and-examples>FAQ and Examples</h2><h3 id=how-do-i-update-to-030>How do I update to 0.3.0?</h3><p>Your existing Archerfile still works the same as before. So nothing to do on this side!</p><p>If you currently use the arrow syntax, make sure to have Mint installed as it moved from an internal to an external dependency. Also make sure to use Swift 5 as Swift 4 support has been dropped.</p><h3 id=is-there-a-new-plugin-concept>Is there a new plugin concept?</h3><p>Previously Mint was the only mechanism to implement plugins. Now as we focus on more general solutions, the new mechanism needs to be more general, too.</p><p>Though more general problems require more solutions or even more specializations. Mint will still be available as any other command line tool. To fill the more general gap, I created <a href=https://github.com/vknabel/mirror-sh>Mirror</a> which tries to solve similar problems on a more general basis.</p><h3 id=how-can-i-share-and-reuse-parts-of-my-metadata>How can I share and reuse parts of my metadata?</h3><p>Now as you can script your metadata, you can also easily reuse parts of your configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>loaders</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>mirror file https://raw.githubusercontent.com/vknabel/Archery/0.3.0/Examples/TestingOnMultiplePlatforms.yml</span>
</span></span></code></pre></div><p>In this example we used <a href=https://github.com/vknabel/mirror-sh>Mirror</a> from above as <code>curl</code> would always download the file over and over. Mirror does it only once.</p><h3 id=project-bash>Project Bash</h3><p>Some larger projects might already require their own CLI. Smaller ones only have a few helpers around.
The following script exposes
Linking all scripts into your current bash session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Archerfile</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>alias</span>: <span style=color:#ae81ff>node Scripts/alias.js</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Scripts/alias.js
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>scripts</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>ARCHERY_METADATA</span>).<span style=color:#a6e22e>scripts</span>;
</span></span><span style=display:flex><span>Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>scripts</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>filter</span>((<span style=color:#a6e22e>name</span>) =&gt; <span style=color:#a6e22e>name</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#34;alias&#34;</span>)
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>name</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>command</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>ARCHERY</span><span style=color:#e6db74>}</span><span style=color:#e6db74> </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>function </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>name</span><span style=color:#e6db74>}</span><span style=color:#e6db74>() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>command</span><span style=color:#e6db74>}</span><span style=color:#e6db74> &#34;$@&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>  });
</span></span></code></pre></div><p>At the end we are capable of linking all helpers directly into our current bash or zsh session!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>$ eval <span style=color:#66d9ef>$(</span>/Users/vknabel/Developer/vknabel/Archery/.build/debug/archery alias<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h3 id=how-can-i-test-on-multiple-operating-systems>How can I test on multiple operating systems?</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>test</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>help</span>: <span style=color:#ae81ff>Runs tests on your current host system, but also on supported linux versions</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>run</span>: [<span style=color:#ae81ff>host, swift5.0, swift5.1]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>scripts</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>host</span>: <span style=color:#ae81ff>swift test</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>swift5.0</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>SWIFT_VERSION</span>: <span style=color:#ae81ff>5.0</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          export CONTAINER=$(docker create ‚Äîrm ‚Äîworkdir /archery swift:$SWIFT_VERSION swift test)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          docker cp . $CONTAINER:/archery
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          docker start ‚Äîattach $CONTAINER</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>swift5.1</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>SWIFT_VERSION</span>: <span style=color:#ae81ff>5.1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          export CONTAINER=$(docker create --rm --workdir /archery swift:$SWIFT_VERSION swift test)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          docker cp . $CONTAINER:/archery
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          docker start ‚Äîattach $CONTAINER</span>
</span></span></code></pre></div><h3 id=how-to-override-with-private-configs>How to override with private configs?</h3><p>Overriding data with Archery is quite easy: load the same data structure with different contents. If you wish some configs to be private, just put them into your <code>.gitignore</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>loaders</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># load default configs</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>cat Config.default.yml</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># override with private configs if existing</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>cat Config.private.yml 2&gt; /dev/null</span>
</span></span></code></pre></div><p>Using the same mechanism you can even override a few scripts, e.g. if you prefer to dockerize your dependencies.</p><h3 id=any-questions-left>Any questions left?</h3><p>If you have any questions left or ideas for improvements, create an issue for <a href=https://github.com/vknabel/Archery>Archery on GitHub</a> or get in contact with <a href=https://mastodon.social/@vknabel>@mastodon.social@vknabel</a>. Thanks for reading!</p><ul class=tags><li class="tags-item tags-item--tag"><a href=/tags/tooling/>Tooling</a></li><li class="tags-item tags-item--tag"><a href=/tags/swift/>Swift</a></li><li class="tags-item tags-item--tag"><a href=/tags/announcement/>Announcement</a></li></div></main><footer><div><small>2026 ¬© Valentin Knabel</small><br><small>Made with ‚ô• by a human.</small><br></div><div><h6 id=menu-social>Social</h6><nav class=menu-social><ul><li><a href=https://github.com/vknabel>GitHub</a></li><li><a href=https://mastodon.social/@vknabel/>Mastodon</a></li><li><a href=https://code.knabel.dev/explore/repos>code.knabel.dev</a></li><li><a href=/rss/>RSS</a></li></ul></nav></div><div><h6 id=menu-links>Links</h6><nav class=menu-tertiary><ul><li><a href=/now/>Now</a></li><li><a href=/colophon/>Colophon</a></li><li><a href=/projects/>Projects</a></li><li><a href=/sovereignity/>Sovereignity</a></li><li><a href=/tags/>Tags</a></li></ul></nav></div></footer></div></body></html>