<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Statically read files with go:embed - vknabel</title><link rel=icon type=image/png href=/images/vknabel.jpg><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Did you ever want to access the contents of an auxiliary file from within your repository to access the contents at runtime? This file could include some static settings like the version of the application, translations for user-facing texts, GraphQL requests or SQL queries. The typical solution to this problem is shipping your binary with the auxiliary files.
But this solution comes with great costs. You cannot ship one single executable anymore. Those files need to sit somewhere in the filesystem. And they might be misplaced, outdated or even missing."><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/statically-read-files-with-go-embed/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="Statically read files with go:embed"><meta property="og:description" content="Did you ever want to access the contents of an auxiliary file from within your repository to access the contents at runtime? This file could include some static settings like the version of the application, translations for user-facing texts, GraphQL requests or SQL queries. The typical solution to this problem is shipping your binary with the auxiliary files.
But this solution comes with great costs. You cannot ship one single executable anymore. Those files need to sit somewhere in the filesystem. And they might be misplaced, outdated or even missing."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-18T00:00:00+00:00"><meta property="article:tag" content="Golang"><meta name=twitter:card content="summary"><meta name=twitter:title content="Statically read files with go:embed"><meta name=twitter:description content="Did you ever want to access the contents of an auxiliary file from within your repository to access the contents at runtime? This file could include some static settings like the version of the application, translations for user-facing texts, GraphQL requests or SQL queries. The typical solution to this problem is shipping your binary with the auxiliary files.
But this solution comes with great costs. You cannot ship one single executable anymore. Those files need to sit somewhere in the filesystem. And they might be misplaced, outdated or even missing."><script src=https://vknabel.com/js/feather.min.js></script><link href=https://vknabel.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://vknabel.com/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://vknabel.com/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css href=/css/overrides.css></head><body><div class=content><header><div class=main><a href=https://vknabel.com/>vknabel</a></div><nav><a href=/>blog</a>
<a href=/tils>tils</a>
<a href=/about>about</a>
<a href=/tags>tags</a></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>Statically read files with go:embed</h1><div class=meta>Posted on Aug 18, 2022</div></div><section class=body><p>Did you ever want to access the contents of an auxiliary file from within your repository to access the contents at runtime? This file could include some static settings like the version of the application, translations for user-facing texts, GraphQL requests or SQL queries. The typical solution to this problem is shipping your binary with the auxiliary files.</p><p>But this solution comes with great costs. You cannot ship one single executable anymore. Those files need to sit somewhere in the filesystem. And they might be misplaced, outdated or even missing.</p><p>Thankfully there is a library and language feature introduced in Go 1.16 that allows you to embed files statically into your binary.</p><blockquote><p>You can <a href=./project.zip>download</a> this example project or jump directly to the source code on <a href=https://github.com/vknabel/vknabel.github.io/tree/main/content/posts/Statically-read-files-with-go-embed/project>Github</a>.</p></blockquote><h2 id=lets-goembed-the-license-file>Let&rsquo;s go:embed the license file</h2><p>For now we want to start easy by embedding the contents a single file. In this case we wish to set our <code>license</code> to the contents of our <code>LICENSE</code> file.</p><p>To get started, we need to import the <code>embed</code> package. As we won&rsquo;t use any member of the embed package for now, we place an underscore before the package. This imports <code>embed</code> solely for its side-effects. Otherwise go fmt would directly erase the import statement.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#a6e22e>_</span> <span style=color:#e6db74>&#34;embed&#34;</span>
</span></span></code></pre></div><p>Now let&rsquo;s create a new variable <code>license</code> and assign the contents of the <code>LICENSE</code> file to it.
We simply initialize the variable by using the <code>go:embed</code> compiler directive.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//go:embed LICENSE</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>license</span> <span style=color:#66d9ef>string</span>
</span></span></code></pre></div><p>And that&rsquo;s it. If we mistype the file name, we get an error. If we forget to import the <code>embed</code> package, we get a warning. But there may be no space between in <code>//go:embed</code> like in normal comments.</p><blockquote><p><strong>Note</strong>: embedding file contents only works for global variables, not for locals.</p></blockquote><p>To actually understand how powerful this feature is, let&rsquo;s write a test by manually reading the file and comparing both.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestEmbedsLicenseFile</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// as usual, read the file</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>bytes</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#e6db74>&#34;LICENSE&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// check for errors</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// convert to string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>want</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>bytes</span>)
</span></span><span style=display:flex><span>	<span style=color:#75715e>// actually use the contents</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>diff</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmp</span>.<span style=color:#a6e22e>Diff</span>(<span style=color:#a6e22e>want</span>, <span style=color:#a6e22e>license</span>); <span style=color:#a6e22e>diff</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected license (-want +got):\n%s&#34;</span>, <span style=color:#a6e22e>diff</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this example, we declared the variable as <code>string</code>, but in other cases you might want to use <code>[]byte</code>. For example if you want to pin the signature of a remote certificate.</p><h2 id=goembed-the-file-system>go:embed the file system</h2><p>In our previous example, we included a very special file that is unique in our repository. But sometimes we have many files, which should all be included in our binary.</p><p>In this case we are going to embed our docs folder within our app. We don&rsquo;t want our users to be forced to leave. Instead we want them to be able to explore and access the docs directly from within our app.</p><p>In this case we are going to create an embedded file system.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;embed&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//go:embed docs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>docsFS</span> <span style=color:#a6e22e>embed</span>.<span style=color:#a6e22e>FS</span>
</span></span></code></pre></div><p><code>embed.FS</code> conforms to <code>fs.FS</code> and as with all <code>fs.FS</code>, we can read directory and file contents. The usage is pretty straightforward.
So let&rsquo;s write a test which checks if the contents of the embedded <code>docs</code> folder are equal to the contents of the <code>docs</code> folder in our repository.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestEmbedsDocs</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dirFS</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>DirFS</span>(<span style=color:#e6db74>&#34;.&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// get all files within the docs directory</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>gotEntries</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>ReadDir</span>(<span style=color:#a6e22e>docsFS</span>, <span style=color:#e6db74>&#34;docs&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>wantEntries</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>ReadDir</span>(<span style=color:#a6e22e>dirFS</span>, <span style=color:#e6db74>&#34;docs&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>gotEntries</span>) <span style=color:#f92672>!=</span> len(<span style=color:#a6e22e>wantEntries</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;got %d entries, want %d&#34;</span>, len(<span style=color:#a6e22e>gotEntries</span>), len(<span style=color:#a6e22e>wantEntries</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>wantEntries</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>diff</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmp</span>.<span style=color:#a6e22e>Diff</span>(<span style=color:#a6e22e>gotEntries</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Name</span>(), <span style=color:#a6e22e>wantEntries</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Name</span>()); <span style=color:#a6e22e>diff</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected entry (-want +got):\n%s&#34;</span>, <span style=color:#a6e22e>diff</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// read the files</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>got</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>docsFS</span>, <span style=color:#e6db74>&#34;docs/&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>gotEntries</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Name</span>())
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>want</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>fs</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#a6e22e>dirFS</span>, <span style=color:#e6db74>&#34;docs/&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>wantEntries</span>[<span style=color:#a6e22e>i</span>].<span style=color:#a6e22e>Name</span>())
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>diff</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmp</span>.<span style=color:#a6e22e>Diff</span>(<span style=color:#a6e22e>got</span>, <span style=color:#a6e22e>want</span>); <span style=color:#a6e22e>diff</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected contents (-want +got):\n%s&#34;</span>, <span style=color:#a6e22e>diff</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>This unit test is probably a bit too much, but it&rsquo;s always a good idea to ensure the embedded contents are valid. Are they valid json? Not empty? Do certain files exist?</p></blockquote><p>Huh? No magic? Yep. As you can see in the test above, the acutal file system and the embedded file system are used exactly the same.
There are no real differences when using the readonly <code>fs.FS</code>. But here&rsquo;s the difference. Nobody guarantees that the files in the os file system has not been tampered with. Or if it has been set up correctly in the expected path. The compiler <em>proves</em> that those files are accessible.</p><p>Another benefit: you decide which files you want to embed. Are you only interested in markdown files? Use <code>//go:embed docs/*.md</code>.</p><p>Let&rsquo;s add another file: the README.md.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>//go:embed README.md</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//go:embed docs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>docsFS</span> <span style=color:#a6e22e>embed</span>.<span style=color:#a6e22e>FS</span>
</span></span></code></pre></div><p>Yep, that&rsquo;s it. We simply add another <code>//go:embed</code> directive. But how do we know if both directives are respected?
Correct, by writing a quick test!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestEmbedsReadme</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// read using the ReadFile method</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>got</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>docsFS</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#e6db74>&#34;README.md&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// as os has, too</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>want</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>ReadFile</span>(<span style=color:#e6db74>&#34;README.md&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>diff</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmp</span>.<span style=color:#a6e22e>Diff</span>(<span style=color:#a6e22e>got</span>, <span style=color:#a6e22e>want</span>); <span style=color:#a6e22e>diff</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unexpected README (-want +got):\n%s&#34;</span>, <span style=color:#a6e22e>diff</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=summary>Summary</h2><p><code>go:embed</code> bundles files and directories into the binary at compile-time. Of course you shouldn&rsquo;t embed all files and blow up your binary size, but it can greatly simplify your deployment process and prove that auxiliary files are accessible and immutable.</p><p>Curious about more use cases? Here is a non-exhaustive list to get started:</p><ul><li>injecting the version of your software</li><li>pinning the signature of a remote certificate</li><li>embedding documentation</li><li>linking against an environment (prod, staging, &mldr;)</li><li>translations / localizations</li><li>GraphQL requests</li><li>SQL queries</li><li>snapshot testing (e.g. for integration tests)</li><li>for loading defaults</li><li>&mldr;</li></ul></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/golang>golang</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/vknabel rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://mastodon.social/@vknabel/ rel=me title=Mastodon><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#at-sign"/></svg></a><a class=border></a></div><div class=footer-info>2025 © Valentin Knabel | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>