<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>ArgumentOverture - vknabel</title><link rel=icon type=image/png href=/images/vknabel.jpg><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content='A Swift Playground aiming to provide some functional helpers to parse arguments for command line tools. It uses Overture and is build for high composability, flexibility and little impact on your project&rsquo;s freedom to evolve.
A central use case was Archery&rsquo;s: only actually interpreted arguments shall be consumed. Any others shall be collected (remaining) or should prevent execution (exhaust), depending on the current command.
First of all an example usage.
// Experiment
do {
    let (isVerbose, whoToGreet, language, _) = try with(["-v", "hi", "Some string", "--language", "en"], chain(
        flag("verbose", "v"),
        positional("Name"),
        argument("language", "l"),
        exhaust
    ))
} catch {
    print("Command failed:", error)
}
The implementation of the micro-library itself.'><meta property="og:image" content><meta property="og:url" content="https://vknabel.com/posts/argumentoverture/"><meta property="og:site_name" content="vknabel"><meta property="og:title" content="ArgumentOverture"><meta property="og:description" content='A Swift Playground aiming to provide some functional helpers to parse arguments for command line tools. It uses Overture and is build for high composability, flexibility and little impact on your project’s freedom to evolve.
A central use case was Archery’s: only actually interpreted arguments shall be consumed. Any others shall be collected (remaining) or should prevent execution (exhaust), depending on the current command.
First of all an example usage.
// Experiment do { let (isVerbose, whoToGreet, language, _) = try with(["-v", "hi", "Some string", "--language", "en"], chain( flag("verbose", "v"), positional("Name"), argument("language", "l"), exhaust )) } catch { print("Command failed:", error) } The implementation of the micro-library itself.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-09-30T00:00:00+00:00"><meta property="article:modified_time" content="2018-09-30T00:00:00+00:00"><meta property="article:tag" content="Swift"><meta property="article:tag" content="Experiment"><meta property="article:tag" content="Cli"><meta name=twitter:card content="summary"><meta name=twitter:title content="ArgumentOverture"><meta name=twitter:description content='A Swift Playground aiming to provide some functional helpers to parse arguments for command line tools. It uses Overture and is build for high composability, flexibility and little impact on your project’s freedom to evolve.
A central use case was Archery’s: only actually interpreted arguments shall be consumed. Any others shall be collected (remaining) or should prevent execution (exhaust), depending on the current command.
First of all an example usage.
// Experiment do { let (isVerbose, whoToGreet, language, _) = try with(["-v", "hi", "Some string", "--language", "en"], chain( flag("verbose", "v"), positional("Name"), argument("language", "l"), exhaust )) } catch { print("Command failed:", error) } The implementation of the micro-library itself.'><script src=https://vknabel.com/js/feather.min.js></script><link href=https://vknabel.com/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://vknabel.com/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://vknabel.com/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css href=/css/overrides.css></head><body><div class=content><header><div class=main><a href=https://vknabel.com/>vknabel</a></div><nav><a href=/>blog</a>
<a href=/tils>tils</a>
<a href=/about>about</a>
<a href=/tags>tags</a></nav></header><main><article><div class=post-container><div class=post-content><div class=title><h1 class=title>ArgumentOverture</h1><div class=meta>Posted on Sep 30, 2018</div></div><section class=body><p>A Swift Playground aiming to provide some functional helpers to parse arguments for command line tools. It uses <a href=https://github.com/pointfreeco/swift-overture>Overture</a> and is build for high composability, flexibility and little impact on your project&rsquo;s freedom to evolve.</p><p>A central use case was <a href=https://github.com/vknabel/archery>Archery</a>&rsquo;s: only actually interpreted arguments shall be consumed. Any others shall be collected (<code>remaining</code>) or should prevent execution (<code>exhaust</code>), depending on the current command.</p><p>First of all an example usage.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Experiment</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> (isVerbose, whoToGreet, language, <span style=color:#66d9ef>_</span>) = <span style=color:#66d9ef>try</span> with([<span style=color:#e6db74>&#34;-v&#34;</span>, <span style=color:#e6db74>&#34;hi&#34;</span>, <span style=color:#e6db74>&#34;Some string&#34;</span>, <span style=color:#e6db74>&#34;--language&#34;</span>, <span style=color:#e6db74>&#34;en&#34;</span>], chain(
</span></span><span style=display:flex><span>        flag(<span style=color:#e6db74>&#34;verbose&#34;</span>, <span style=color:#e6db74>&#34;v&#34;</span>),
</span></span><span style=display:flex><span>        positional(<span style=color:#e6db74>&#34;Name&#34;</span>),
</span></span><span style=display:flex><span>        argument(<span style=color:#e6db74>&#34;language&#34;</span>, <span style=color:#e6db74>&#34;l&#34;</span>),
</span></span><span style=display:flex><span>        exhaust
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Command failed:&#34;</span>, error)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The implementation of the micro-library itself.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span><span style=color:#75715e>// Errors</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>quoted</span>(<span style=color:#66d9ef>_</span> string: String) -&gt; String {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>\(</span>string<span style=color:#e6db74>)</span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>protocol</span> <span style=color:#a6e22e>StringConvertibleError</span>: Error, CustomStringConvertible {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>MissingArgumentError</span>: StringConvertibleError {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>let</span> name: String?
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>var</span> description: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> with(name, pipe(
</span></span><span style=display:flex><span>            map(quoted),
</span></span><span style=display:flex><span>            map { <span style=color:#e6db74>&#34;Missing argument </span><span style=color:#e6db74>\(</span>$0<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span> },
</span></span><span style=display:flex><span>            ??<span style=color:#e6db74>&#34;Missing argument&#34;</span>
</span></span><span style=display:flex><span>        ))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>NonExhaustiveArgumentsError</span>: StringConvertibleError {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>let</span> remaining: [String]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>var</span> description: String {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Unused arguments: </span><span style=color:#e6db74>\(</span>remaining<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Domain</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isArgument</span>(named name: String) -&gt; (String) -&gt; Bool {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { $0 == <span style=color:#e6db74>&#34;-</span><span style=color:#e6db74>\(</span>name<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> $0 == <span style=color:#e6db74>&#34;--</span><span style=color:#e6db74>\(</span>name<span style=color:#e6db74>)</span><span style=color:#e6db74>&#34;</span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>isOneArgument</span>(of names: [String]) -&gt; (String) -&gt; Bool {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { passed <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        names.<span style=color:#66d9ef>lazy</span>
</span></span><span style=display:flex><span>        .map(isArgument(named:))
</span></span><span style=display:flex><span>        .reduce(<span style=color:#66d9ef>false</span>, { $0 <span style=color:#f92672>||</span> $1(passed) })
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>indexOfArguments</span>(named names: [String]) -&gt; ([String]) -&gt; Array&lt;String&gt;.Index? {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { passed <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        passed.index(<span style=color:#66d9ef>where</span>: isOneArgument(of: names))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>flag</span>(<span style=color:#66d9ef>_</span> names: String...) -&gt; ([String]) -&gt; ([String], Bool) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { arguments <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> index = arguments.index(<span style=color:#66d9ef>where</span>: isOneArgument(of: names)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = arguments
</span></span><span style=display:flex><span>            result.remove(at: index)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (result, <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (arguments, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>positional</span>(<span style=color:#66d9ef>_</span> name: String? = <span style=color:#66d9ef>nil</span>) -&gt; ([String]) <span style=color:#66d9ef>throws</span> -&gt; ([String], String) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { arguments <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> index = arguments.index(<span style=color:#66d9ef>where</span>: { <span style=color:#f92672>!</span>$0.starts(with: <span style=color:#e6db74>&#34;-&#34;</span>)})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> index = index {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = arguments
</span></span><span style=display:flex><span>            result.remove(at: index)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (result, arguments[index])
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span>  MissingArgumentError(name: name)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>optional</span>&lt;A&gt;(<span style=color:#66d9ef>_</span> f: @escaping ([String]) <span style=color:#66d9ef>throws</span> -&gt; ([String], A)) -&gt; ([String]) <span style=color:#66d9ef>throws</span> -&gt; ([String], A?) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { arguments <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> (remaining, parsed) = <span style=color:#66d9ef>try</span> f(arguments)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (remaining, .some(parsed))
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> <span style=color:#66d9ef>is</span> MissingArgumentError {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (arguments, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> error
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>argument</span>(<span style=color:#66d9ef>_</span> names: String...) -&gt; ([String]) <span style=color:#66d9ef>throws</span> -&gt;  ([String], String) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> { arguments <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>let</span> flagIndex = indexOfArguments(named: names)(arguments), arguments.count <span style=color:#f92672>&gt;=</span> flagIndex <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> value = arguments[flagIndex <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> rest = arguments
</span></span><span style=display:flex><span>            rest.remove(at: flagIndex <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            rest.remove(at: flagIndex)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (rest, value)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> MissingArgumentError(name: names.first)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>exhaust</span>(<span style=color:#66d9ef>_</span> arguments: [String]) <span style=color:#66d9ef>throws</span> -&gt; ([String], Void) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> arguments.isEmpty {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ([], ())
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> NonExhaustiveArgumentsError(remaining: arguments)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>remaining</span>(<span style=color:#66d9ef>_</span> arguments: [String]) -&gt; ([String], [String]) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ([], arguments)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=whats-next>What&rsquo;s next?</h2><p>The same concept could be applied to processes and especially handling interrupts:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>with(Process(), concat(
</span></span><span style=display:flex><span>    setWorkingDir(<span style=color:#e6db74>&#34;tmp&#34;</span>),
</span></span><span style=display:flex><span>    passInterrupt(),
</span></span><span style=display:flex><span>    setBashCommand(<span style=color:#e6db74>&#34;&#34;</span>) <span style=color:#75715e>// is { concat(setLaunchPath(&#34;/bin/bash&#34;), setArguments([&#34;-c&#34;, $0]) }</span>
</span></span><span style=display:flex><span>))
</span></span></code></pre></div><p><em><a href=./playground.zip>download this playground</a></em></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/swift>swift</a></li><li><a href=/tags/experiment>experiment</a></li><li><a href=/tags/cli>cli</a></li></ul></nav></div></div></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/vknabel rel=me title=GitHub><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github"/></svg></a><a class=border></a><a class=soc href=https://mastodon.social/@vknabel/ rel=me title=Mastodon><svg class="feather"><use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#at-sign"/></svg></a><a class=border></a></div><div class=footer-info>2025 © Valentin Knabel | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer></div></body></html>